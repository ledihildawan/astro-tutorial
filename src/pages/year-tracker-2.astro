<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Chronos Grid 2026 - Symmetry Edition v2.5</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet" />

    <style is:global>
      :root {
        --base-hex: #f0eee9;
        --full-h: 100dvh;
        --bg-system: oklch(from var(--base-hex) 0.97 0.01 h);
        --color-today: var(--base-hex);
        --color-past: oklch(from var(--base-hex) 0.45 0.05 h);
        --color-future: oklch(from var(--base-hex) 0.93 0.02 h);
        --color-ghost-label: oklch(from var(--base-hex) 0.3 0.05 h);
        --color-year-subliminal: oklch(from var(--bg-system) 0.93 0.01 h);
        --radius-standard: 2px;
        --transition-smooth: 0.8s cubic-bezier(0.22, 1, 0.36, 1);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        cursor: default;
      }

      body {
        height: var(--full-h);
        width: 100dvw;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: var(--bg-system);
        font-family: 'Inter', sans-serif;
        transition: background-color 1.2s ease;
        cursor: pointer;
      }

      #chronos-container {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
      }

      #chronos-viewport {
        display: grid;
        will-change: transform, filter;
        z-index: 2;
      }

      #year-watermark {
        position: absolute;
        z-index: 1;
        font-weight: 900;
        font-size: clamp(100px, 25vw, 450px);
        color: var(--color-year-subliminal);
        opacity: 0.4;
        letter-spacing: -0.06em;
        pointer-events: none;
        user-select: none;
        display: flex;
        justify-content: center;
        align-items: center;
        line-height: 0;
      }

      @keyframes theme-pulse-anim {
        0% {
          transform: scale(1);
          filter: brightness(1);
        }
        50% {
          transform: scale(1.01);
          filter: brightness(1.05);
        }
        100% {
          transform: scale(1);
          filter: brightness(1);
        }
      }

      .theme-pulse {
        animation: theme-pulse-anim 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      .day {
        width: 100%;
        height: 100%;
        border-radius: var(--radius-standard);
        transition:
          background-color var(--transition-smooth),
          opacity var(--transition-smooth),
          transform 0.3s ease,
          filter var(--transition-smooth);
        position: relative;
        overflow: hidden;
      }

      .day--past {
        background-color: var(--color-past);
      }
      .day--future {
        background-color: var(--color-future);
        box-shadow: inset 0 0 0 0.5px oklch(from var(--base-hex) 0.8 0.02 h / 0.15);
      }
      .day--filler {
        opacity: 0.06;
        background-color: var(--color-past);
        filter: grayscale(100%);
      }
      .day--today {
        background-color: var(--color-today) !important;
        opacity: 1 !important;
        box-shadow:
          0 0 0 2px var(--bg-system),
          0 12px 30px oklch(from var(--base-hex) 0.2 0.1 h / 0.35);
        z-index: 10;
        border-radius: 3px;
        filter: none !important;
      }
      .now-indicator {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        background-color: oklch(from var(--base-hex) 0.3 0.1 h / 0.5);
        width: 0%;
        transition: width 1s linear;
        z-index: 5;
      }
      .day--monday::after {
        content: '';
        position: absolute;
        bottom: 12%;
        left: 50%;
        transform: translateX(-50%);
        width: 2px;
        height: 2px;
        border-radius: 50%;
        background-color: var(--color-ghost-label);
        opacity: 0.15;
        z-index: 4;
      }
      .day[data-ghost-label]::before {
        content: attr(data-ghost-label);
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: clamp(6px, 0.8vw, 11px);
        font-weight: 800;
        letter-spacing: 0.12em;
        color: var(--color-ghost-label);
        opacity: 0.25;
        pointer-events: none;
        white-space: nowrap;
        z-index: 3;
      }
      .day--past[data-ghost-label]::before {
        color: oklch(from var(--base-hex) 0.9 0.05 h);
        opacity: 0.5;
      }
      .day:hover {
        transform: scale(1.3);
        z-index: 20;
        opacity: 1 !important;
        box-shadow: 0 8px 25px oklch(from var(--base-hex) 0.2 0.1 h / 0.25);
        background-color: var(--color-today);
        filter: brightness(1.1) grayscale(0%) !important;
      }
      .day--past[data-ghost-label]:hover::before {
        color: var(--color-ghost-label);
        opacity: 0.3;
      }
    </style>
  </head>
  <body>
    <div id="chronos-container">
      <div id="year-watermark">2026</div>
      <div id="chronos-viewport"></div>
    </div>

    <script type="module">
      const THEME_COLORS = [
        '#F0EEE9',
        '#2F6364',
        '#FFBE98',
        '#0F4C81',
        '#88B04B',
        '#F7CAC9',
        '#92A8D1',
        '#955251',
        '#AD5E99',
        '#009473',
      ];

      const MONTHS = ['JAN', 'FEB', 'MAR', 'APR', 'MEI', 'JUN', 'JUL', 'AGU', 'SEP', 'OKT', 'NOV', 'DES'];

      class ChronosEngine {
        constructor() {
          this.viewport = document.getElementById('chronos-viewport');
          this.year = 2026;
          const savedIndex = localStorage.getItem('chronos_theme_index');
          this.colorIndex = savedIndex ? parseInt(savedIndex) : 0;
          this.init();
        }

        init() {
          this.applyTheme(THEME_COLORS[this.colorIndex]);

          // Tekan 'C' → cycle theme + random day
          window.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 'c') {
              e.preventDefault();
              this.cycleTheme();
            }
          });

          // Triple-tap → cycle theme + random day
          let tapCount = 0;
          let tapTimer;
          document.body.addEventListener('click', () => {
            tapCount++;
            clearTimeout(tapTimer);
            tapTimer = setTimeout(() => {
              if (tapCount === 3) {
                this.cycleTheme();
              }
              tapCount = 0;
            }, 600);
          });

          window.addEventListener('resize', () => this.debounceRender());

          this.renderWithRealToday();

          // Update progress bar setiap menit
          this.updateProgressBar();
          setInterval(() => this.updateProgressBar(), 60000);
        }

        cycleTheme() {
          this.colorIndex = (this.colorIndex + 1) % THEME_COLORS.length;
          this.applyTheme(THEME_COLORS[this.colorIndex]);
          localStorage.setItem('chronos_theme_index', this.colorIndex);

          // Pulse feedback
          this.viewport.classList.remove('theme-pulse');
          void this.viewport.offsetWidth;
          this.viewport.classList.add('theme-pulse');

          this.renderWithRandomToday();
        }

        applyTheme(hex) {
          document.documentElement.style.setProperty('--base-hex', hex);
        }

        debounceRender() {
          clearTimeout(this.resizeTimer);
          this.resizeTimer = setTimeout(() => this.renderWithCurrentToday(), 100);
        }

        updateProgressBar() {
          const bar = document.querySelector('.now-indicator');
          if (bar) {
            const now = new Date();
            const minutes = now.getHours() * 60 + now.getMinutes();
            const percentage = (minutes / 1440) * 100;
            bar.style.width = `${percentage}%`;
          }
        }

        renderWithRealToday() {
          const realToday = new Date();
          this.currentTodayInfo = {
            str: realToday.toDateString(),
            time: new Date(realToday.getFullYear(), realToday.getMonth(), realToday.getDate(), 12).getTime(),
            month: realToday.getMonth(),
          };
          this._render(this.currentTodayInfo);
        }

        renderWithRandomToday() {
          const isLeap = (this.year % 4 === 0 && this.year % 100 !== 0) || this.year % 400 === 0;
          const days = isLeap ? 366 : 365;
          const randomDay = Math.floor(Math.random() * days) + 1;
          const randomDate = new Date(this.year, 0, randomDay);

          this.currentTodayInfo = {
            str: randomDate.toDateString(),
            time: new Date(randomDate.getFullYear(), randomDate.getMonth(), randomDate.getDate(), 12).getTime(),
            month: randomDate.getMonth(),
          };
          this._render(this.currentTodayInfo);
        }

        renderWithCurrentToday() {
          if (this.currentTodayInfo) {
            this._render(this.currentTodayInfo);
          }
        }

        _render(todayInfo) {
          const isLeap = (this.year % 4 === 0 && this.year % 100 !== 0) || this.year % 400 === 0;
          const days = isLeap ? 366 : 365;
          const w = window.innerWidth;
          const h = window.innerHeight;
          const scale = Math.max(w, 240) / 1200;
          const gap = Math.max(2, 10 * scale);
          const frame = Math.max(25, 50 * scale);
          const availW = w - frame * 2;
          const availH = h - frame * 2;

          let bestS = 0;
          for (let c = 1; c <= days; c++) {
            const r = Math.ceil(days / c);
            const s = Math.min((availW - (c - 1) * gap) / c, (availH - (r - 1) * gap) / r);
            if (s > bestS) bestS = s;
          }

          const s = Math.floor(bestS);
          const cols = Math.floor((availW + gap) / (s + gap));
          const rows = Math.floor((availH + gap) / (s + gap));

          const totalCells = cols * rows;
          const startOffset = Math.floor((totalCells - days) / 2);
          const startDate = new Date(this.year, 0, 1, 12);
          startDate.setDate(startDate.getDate() - startOffset);

          this.viewport.style.cssText = `
            gap: ${gap}px;
            grid-template-columns: repeat(${cols}, ${s}px);
            grid-template-rows: repeat(${rows}, ${s}px);
          `;

          requestAnimationFrame(() => {
            const gridRect = this.viewport.getBoundingClientRect();
            this.watermark.style.width = `${gridRect.width}px`;
            this.watermark.style.height = `${gridRect.height}px`;
          });

          const fragment = document.createDocumentFragment();
          const cursor = new Date(startDate);

          for (let i = 0; i < totalCells; i++) {
            const el = document.createElement('div');
            const dYear = cursor.getFullYear();
            const dTime = cursor.getTime();

            let type = 'filler';
            if (dYear === this.year) {
              if (cursor.toDateString() === todayInfo.str) {
                type = 'today';
              } else if (dTime < todayInfo.time) {
                type = 'past';
                const diff = Math.floor((todayInfo.time - dTime) / 86400000);
                el.style.opacity = Math.max(0.12, 1 - diff * 0.008);
                const grayscale = Math.min(100, diff * 0.5);
                el.style.filter = `grayscale(${grayscale}%)`;
              } else {
                type = 'future';
              }

              if (cursor.getDay() === 1) el.classList.add('day--monday');

              if (cursor.getDate() === 1) {
                el.setAttribute('data-ghost-label', MONTHS[cursor.getMonth()]);
              }
            } else {
              el.style.opacity = '0.06';
            }

            el.className = `day day--${type}`;

            if (type === 'today') {
              const bar = document.createElement('div');
              bar.className = 'now-indicator';
              el.appendChild(bar);
            }

            fragment.appendChild(el);
            cursor.setDate(cursor.getDate() + 1);
          }

          this.viewport.innerHTML = '';
          this.viewport.appendChild(fragment);
          this.updateProgressBar();
        }
      }

      new ChronosEngine();
    </script>
  </body>
</html>
