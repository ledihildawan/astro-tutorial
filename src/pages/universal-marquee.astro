---
// src/pages/index.astro
---

<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Universal Marquee v15.9 – Consistent Variable</title>

    <style is:global data-label="CORE_STYLES">
      :root {
        --um-duration-default: 15s;
        --um-gap-default: 2rem;
        --um-color-separator: #9ca3af;
        --um-separator-height: 1.25em;
      }
      .um-container {
        display: flex;
        overflow: hidden;
        user-select: none;
        width: 100%;
        min-width: 0;
        position: relative;
        transform: translate3d(0, 0, 0);
      }
      .um-sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border-width: 0;
      }
      /* Track Logic */
      .um-container .um-track {
        display: none;
      }
      .um-container.js-enabled .um-track {
        display: flex;
      }
      .um-track {
        align-items: center;
        flex-wrap: nowrap;
        gap: var(--um-gap);
        will-change: transform;
        backface-visibility: hidden;
        perspective: 1000px;
      }
      .um-track > div {
        display: flex;
        align-items: center;
        flex-wrap: nowrap;
        flex-shrink: 0;
        gap: var(--um-gap);
      }
      .um-track > div > * {
        flex-shrink: 0;
        white-space: nowrap;
        display: flex;
        align-items: center;
        width: auto;
        object-fit: contain;
      }
      /* Skeleton & Image Handling */
      .um-img-skeleton {
        position: relative;
        background-color: #e5e7eb;
        overflow: hidden;
        border-radius: 4px;
        transition: background-color 0.3s;
      }
      .um-img-skeleton img {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        opacity: 0;
        transition: opacity 0.5s ease-out;
      }
      .um-img-skeleton img.loaded {
        opacity: 1;
      }
      /* Separator Specifics */
      .um-item-separator {
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .um-item-separator .um-img-skeleton {
        display: inline-block;
        height: var(--um-separator-height);
        width: auto;
        min-width: var(--um-separator-height);
        aspect-ratio: 1/1;
        background-color: transparent;
      }

      /* === AKSESIBILITAS: PREFERS-REDUCED-MOTION === */
      @media (prefers-reduced-motion: reduce) {
        .um-container {
          overflow-x: auto !important;
          -webkit-overflow-scrolling: touch;
          cursor: grab;
          scrollbar-width: none;
          -ms-overflow-style: none;
        }
        .um-container::-webkit-scrollbar {
          display: none;
        }
        .um-track {
          width: max-content !important;
          transform: none !important;
          animation: none !important;
          justify-content: flex-start;
        }
      }
    </style>

    <style is:global data-label="ROOT_LAYOUT">
      :root {
        --color-bg-page: #f9fafb;
        --color-text-primary: #111827;
        /* Hapus --color-guide-border, hanya gunakan --color-gridline */
        --color-gridline: #ef4444;

        /* --- UKURAN LAYOUT --- */
        --layout-max-width: 1100px;
        --layout-gutter: 1.25rem;
        --layout-guide-width: 1px;
        --layout-guide-style: dashed;
        --layout-vertical-padding: 3rem;
        --layout-footer-height: 3rem;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', Arial, sans-serif;
        display: flex;
        background-color: var(--color-bg-page);
        color: var(--color-text-primary);
        min-height: 100vh;
      }

      /* --- RootLayout Structure --- */
      .RootLayout {
        position: relative;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        z-index: 0;
      }

      /* GARIS HORIZONTAL (ATAS & BAWAH) */
      .RootLayout::before,
      .RootLayout::after {
        content: '';
        /* Menggunakan --color-gridline */
        border-top: var(--layout-guide-width) var(--layout-guide-style) var(--color-gridline);
        height: 0;
        position: absolute;
        left: 0;
        right: 0;
        z-index: 1;
        opacity: 1;
      }
      .RootLayout::before {
        top: var(--layout-vertical-padding);
      }
      .RootLayout::after {
        bottom: var(--layout-vertical-padding);
        /* Menggunakan --color-gridline */
        border-bottom: var(--layout-guide-width) var(--layout-guide-style) var(--color-gridline);
        border-top: none;
      }

      /* --- CONTAINER UTAMA (Mobile First) --- */
      /* Ganti seluruh blok .RootLayoutContainer (Line 126) */
      .RootLayoutContainer {
        width: calc(100% - (var(--layout-gutter) * 2));
        max-width: var(--layout-max-width);

        /* FIX: Ganti min-height: 100dvh menjadi min-height: 100% */
        /* Kontainer utama (RootLayout) yang akan kita gunakan untuk menentukan tinggi 100% */
        min-height: 100%;

        position: relative;
        margin-inline: auto;
        display: flex;
        flex-direction: column;

        border: none;

        /* FIX: Hapus padding-bottom. Kita akan menggunakan margin-top pada footer */
        padding-top: var(--layout-vertical-padding);
        padding-bottom: 0; /* Hapus padding yang mengalokasikan ruang footer */
        box-sizing: border-box;
      }

      /* Ganti seluruh blok .RootLayoutContent (Line 144) */
      .RootLayoutContent {
        display: flex;
        flex-direction: column;
        padding: 2rem 0;
        gap: 3rem;
        flex: 1; /* Konten tumbuh untuk mendorong footer */
      }

      /* Ganti seluruh blok .RootLayoutFooter (Line 153) */
      .RootLayoutFooter {
        width: 100%;
        height: var(--layout-footer-height);
        /* FIX: Hapus position: absolute dan bottom: 0 */
        position: static;
        bottom: auto;
        left: 0;
        right: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85rem;
        color: #6b7280;
        border-top: none;
        /* Tambahkan padding-top untuk memastikan konten di atas footer tidak menabrak */
        margin-top: var(--layout-footer-height);
      }

      h2.demo-title {
        margin: 0 0 0.5rem 0;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-align: center;
        color: #374151;
      }
      p.demo-desc {
        text-align: center;
        margin: 0 0 1rem 0;
        font-size: 0.85rem;
        color: #9ca3af;
      }

      /* --- MEDIA QUERY (Desktop: > 64rem / 1024px) --- */
      @media (min-width: 64rem) {
        /* 1. GARIS HORIZONTAL (Atas/Bawah) tetap DASHED */
        .RootLayout::before,
        .RootLayout::after {
          opacity: 1;
          background-color: transparent;
          height: 0;
        }

        /* 2. Tambah Padding Samping Konten */
        .RootLayoutContent {
          padding: 2rem;
        }

        /* 3. MUNCULKAN GARIS VERTIKAL (Kiri & Kanan) - Dashed */
        .RootLayoutContainer {
          /* Menggunakan --color-gridline */
          border-left: var(--layout-guide-width) var(--layout-guide-style) var(--color-gridline);
          border-right: var(--layout-guide-width) var(--layout-guide-style) var(--color-gridline);
        }

        /* 4. Hapus pseudo-elements solid (jika ada) */
        .RootLayoutContainer:before,
        .RootLayoutContainer:after {
          content: none;
        }
      }
    </style>
  </head>

  <body>
    <div class="RootLayout">
      <div class="RootLayoutContainer">
        <div class="RootLayoutContent">
          <div>
            <h2 class="demo-title">Area 1: Services & Branding</h2>
            <p class="demo-desc">Gap: 6rem | Speed: Slow | Separator: MD Pabel Logo</p>
            <div
              id="marquee-demo-1"
              style="background: #fff; border: 1px solid #eee; border-radius: 6px; padding: 1rem 0; --um-font-size: 1.5rem; --um-gap: 6rem; --um-separator-height: 24px"
            >
              <noscript>Javascript Required.</noscript>
            </div>
          </div>

          <div>
            <h2 class="demo-title">Area 2: News Ticker</h2>
            <p class="demo-desc">Gap: 2rem | Speed: Fast | Dark Theme</p>
            <div
              id="marquee-demo-2"
              style="background: #111827; color: white; padding: 0.8rem 0; --um-font-size: 1rem; --um-gap: 2rem;"
            >
            </div>
          </div>

          <div>
            <h2 class="demo-title">Area 3: Full Lazy Loading Gallery</h2>
            <p class="demo-desc">Items & Separators are Images with Skeleton Loaders</p>
            <div id="marquee-full-lazy" style="--um-gap: 3rem; --um-separator-height: 40px"></div>
          </div>
        </div>

        <div class="RootLayoutFooter">
          <span>Universal Marquee Demo &copy; 2025 – Consistent Grid</span>
        </div>
      </div>
    </div>

    <script type="module">
      class ContentBuilder {
        _opts;
        constructor(options) {
          this._opts = options;
        }
        #buildSeparatorNode(separator) {
          const sepContainer = document.createElement('span');
          sepContainer.classList.add('um-item-separator');
          sepContainer.setAttribute('aria-hidden', 'true');
          if (typeof separator === 'string') {
            sepContainer.textContent = separator;
          } else if (separator instanceof Node) {
            sepContainer.appendChild(separator.cloneNode(true));
          } else if (typeof separator === 'object' && separator?.type === 'image') {
            const wrapper = document.createElement('div');
            wrapper.className = 'um-img-skeleton';
            const img = document.createElement('img');
            img.src = separator.src;
            img.alt = separator.alt || '';
            img.loading = 'lazy';
            const handleLoad = () => img.classList.add('loaded');
            img.onload = handleLoad;
            if (img.complete) handleLoad();
            wrapper.appendChild(img);
            sepContainer.appendChild(wrapper);
          }
          return sepContainer;
        }
        buildCycleContent(forSR = false) {
          const frag = document.createDocumentFragment();
          const items = this._opts.items;
          if (!items || items.length === 0) return frag;
          for (let i = 0; i < items.length; i++) {
            const item = items[i];
            if (forSR) {
              const li = document.createElement('li');
              li.textContent = item.alt || item;
              frag.appendChild(li);
            } else {
              let node = this._opts.renderItem(item);
              if (!(node instanceof Element)) {
                const w = document.createElement('span');
                w.appendChild(node);
                node = w;
              }
              const cloned = node.cloneNode(true);
              const img = cloned.querySelector('img');
              if (img) {
                if (img.complete) img.classList.add('loaded');
                else img.onload = () => img.classList.add('loaded');
              }
              if (cloned.id) cloned.removeAttribute('id');
              cloned.querySelectorAll('*').forEach((el) => {
                if (el.id) el.removeAttribute('id');
                el.setAttribute('tabindex', '-1');
              });
              frag.appendChild(cloned);
              const sep = this.#buildSeparatorNode(this._opts.separator);
              if (sep) frag.appendChild(sep);
            }
          }
          return frag;
        }
        buildCycleContainer() {
          const c = document.createElement('div');
          c.appendChild(this.buildCycleContent(false));
          return c;
        }
        buildSRList() {
          const ul = document.createElement('ul');
          ul.className = 'um-sr-only';
          ul.appendChild(this.buildCycleContent(true));
          return ul;
        }
        measureCycleMetrics(root, track) {
          if (!this._opts.items || this._opts.items.length === 0) return { width: 0, gap: 0 };
          const temp = document.createElement('div');
          temp.className = 'um-track';
          Object.assign(temp.style, { position: 'absolute', visibility: 'hidden' });
          let gapVal = this._opts.gap;
          if (typeof gapVal === 'number') gapVal = `${gapVal}px`;
          temp.style.setProperty('--um-gap', gapVal);
          const cycle = this.buildCycleContainer();
          temp.appendChild(cycle);
          root.appendChild(temp);
          const width = cycle.offsetWidth || 0;
          const style = getComputedStyle(temp);
          let parsedGap = parseFloat(style.columnGap || style.gap || '0');
          if (isNaN(parsedGap)) parsedGap = 0;
          root.removeChild(temp);
          return { width, gap: parsedGap };
        }
      }

      class AnimationController {
        _track;
        _opts;
        _anim = null;

        constructor(track, opts) {
          this._track = track;
          this._opts = opts;
        }

        start(width, gap) {
          if (this._anim) this._anim.cancel();

          const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          if (prefersReducedMotion) return;

          const safeWidth = Number.isFinite(width) ? width : 0;
          const safeGap = Number.isFinite(gap) ? gap : 0;
          const safeSpeed = this._opts.speed && this._opts.speed > 0 ? this._opts.speed : 50;
          const dist = safeWidth + safeGap;
          if (dist <= 0) return;

          const duration = (dist / safeSpeed) * 1000;
          let from = 'translate3d(0,0,0)';
          let to = `translate3d(-${dist}px,0,0)`;
          if (this._opts.direction === 'right') {
            from = `translate3d(-${dist}px,0,0)`;
            to = 'translate3d(0,0,0)';
          }

          this._anim = this._track.animate([{ transform: from }, { transform: to }], {
            duration,
            iterations: Infinity,
            easing: 'linear',
          });
        }

        pause() {
          if (this._anim && this._anim.playState === 'running') {
            this._anim.pause();
          }
        }

        play() {
          if (this._anim && this._anim.playState !== 'running') {
            this._anim.play();
          }
        }
      }

      class UniversalMarquee {
        _resizeTimer;
        _observer;
        _isInViewport = false;

        constructor(selector, opts) {
          this._root = document.querySelector(selector);
          if (!this._root) return;
          this._opts = {
            speed: 50,
            gap: '2rem',
            direction: 'left',
            items: [],
            separator: '',
            renderItem: (i) => document.createTextNode(i),
            ...opts,
          };
          this._root.classList.add('um-container', 'js-enabled');
          this._builder = new ContentBuilder(this._opts);

          this.#setup();
          this.#initObservers();
        }

        #setup() {
          this._root.innerHTML = '';
          this._track = document.createElement('div');
          this._track.className = 'um-track';
          this._track.setAttribute('aria-hidden', 'true');
          this._root.appendChild(this._builder.buildSRList());
          this._root.appendChild(this._track);
          this.#reflow();
        }

        #reflow() {
          const m = this._builder.measureCycleMetrics(this._root, this._track);
          if (m.width === 0) return;
          const cycles = Math.ceil(this._root.offsetWidth / (m.width + m.gap)) + 2;
          this._track.innerHTML = '';
          const frag = document.createDocumentFragment();
          for (let i = 0; i < Math.max(3, cycles); i++) frag.appendChild(this._builder.buildCycleContainer());
          this._track.appendChild(frag);

          if (!this._anim) this._anim = new AnimationController(this._track, this._opts);
          this._anim.start(m.width, m.gap);
        }

        #initObservers() {
          const resizeHandler = () => {
            clearTimeout(this._resizeTimer);
            this._resizeTimer = setTimeout(() => {
              requestAnimationFrame(this.#reflow.bind(this));
            }, 200);
          };
          new ResizeObserver(resizeHandler).observe(this._root);

          if ('IntersectionObserver' in window) {
            this._observer = new IntersectionObserver(
              (entries) => {
                entries.forEach((entry) => {
                  if (!this._anim) return;
                  this._isInViewport = entry.isIntersecting;
                  if (entry.isIntersecting) {
                    if (!document.hidden) this._anim.play();
                  } else {
                    this._anim.pause();
                  }
                });
              },
              { rootMargin: '50px 0px' }
            );
            this._observer.observe(this._root);
          }

          document.addEventListener('visibilitychange', () => {
            if (!this._anim) return;
            if (document.hidden) {
              this._anim.pause();
            } else {
              if (this._isInViewport) this._anim.play();
            }
          });
        }
      }

      window.UniversalMarquee = UniversalMarquee;
    </script>

    <script type="module">
      const initApp = () => {
        const ITEMS_DEMO_1 = ['Web Design', 'App Development', 'SEO Audit', 'Cloud Server', 'Consulting'];
        const SEPARATOR_DEMO_1 = {
          type: 'image',
          src: 'https://www.mdpabel.com/md-pabel.png',
          alt: 'Logo MDPabel',
        };
        const ITEMS_DEMO_2 = ['LOREM IPSUM', 'DOLOR SIT AMET', 'CONSECTETUR ADIPISCING', 'ELIT SED DO'];
        const GALLERY_ITEMS = [
          { src: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&q=80', alt: 'Red Shoe' },
          { src: 'https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?w=400&q=80', alt: 'White Sneaker' },
          { src: 'https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?w=400&q=80', alt: 'Green Shoe' },
        ];

        const textRenderer = (txt) => {
          const s = document.createElement('span');
          s.textContent = txt;
          s.style.fontWeight = '600';
          return s;
        };

        const imageRenderer = (item) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'um-img-skeleton';
          wrapper.style.width = '140px';
          wrapper.style.height = '90px';
          const img = document.createElement('img');
          img.src = item.src;
          img.alt = item.alt;
          img.loading = 'lazy';
          const onLoad = () => img.classList.add('loaded');
          img.onload = onLoad;
          if (img.complete) onLoad();
          wrapper.appendChild(img);
          return wrapper;
        };

        new window.UniversalMarquee('#marquee-demo-1', {
          speed: 60,
          gap: '6rem',
          items: ITEMS_DEMO_1,
          separator: SEPARATOR_DEMO_1,
          renderItem: textRenderer,
        });

        new window.UniversalMarquee('#marquee-demo-2', {
          speed: 100,
          gap: '2rem',
          direction: 'right',
          items: ITEMS_DEMO_2,
          separator: ' • ',
          renderItem: (t) => {
            const s = document.createElement('span');
            s.textContent = t;
            s.style.color = '#e5e7eb';
            return s;
          },
        });

        new window.UniversalMarquee('#marquee-full-lazy', {
          speed: 50,
          gap: '3rem',
          items: GALLERY_ITEMS,
          separator: {
            type: 'image',
            src: 'https://cdn-icons-png.flaticon.com/512/766/766029.png',
            alt: '',
          },
          renderItem: imageRenderer,
        });
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initApp);
      } else {
        initApp();
      }
    </script>
  </body>
</html>
