<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Universal Marquee v15.9 – Consistent Variable</title>
    <style is:global data-label="CORE_STYLES">
      :root {
        --um-duration-default: 15s;
        --um-gap-default: 2rem;
        --um-color-separator: #9ca3af;
        --um-separator-height: 1.25em;
      }
      .um-container {
        display: flex;
        overflow: hidden;
        user-select: none;
        width: 100%;
        min-width: 0;
        position: relative;
        transform: translate3d(0, 0, 0);
      }
      .um-sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border-width: 0;
      }
      .um-container .um-track {
        display: none;
      }
      .um-container.js-enabled .um-track {
        display: flex;
      }
      .um-track {
        align-items: center;
        flex-wrap: nowrap;
        gap: var(--um-gap);
        will-change: transform;
        backface-visibility: hidden;
        perspective: 1000px;
      }
      .um-track > div {
        display: flex;
        align-items: center;
        flex-wrap: nowrap;
        flex-shrink: 0;
        gap: var(--um-gap);
      }
      .um-track > div > * {
        flex-shrink: 0;
        white-space: nowrap;
        display: flex;
        align-items: center;
        width: auto;
        object-fit: contain;
      }
      .um-img-skeleton {
        position: relative;
        background-color: #e5e7eb;
        overflow: hidden;
        border-radius: 4px;
        transition: background-color 0.3s;
      }
      .um-img-skeleton img {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        opacity: 0;
        transition: opacity 0.5s ease-out;
      }
      .um-img-skeleton img.loaded {
        opacity: 1;
      }
      .um-item-separator {
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .um-item-separator .um-img-skeleton {
        display: inline-block;
        height: var(--um-separator-height);
        width: auto;
        min-width: var(--um-separator-height);
        aspect-ratio: 1/1;
        background-color: transparent;
      }
      @media (prefers-reduced-motion: reduce) {
        .um-container {
          overflow-x: auto !important;
          -webkit-overflow-scrolling: touch;
        }
        .um-track {
          width: max-content !important;
          transform: none !important;
          animation: none !important;
          justify-content: flex-start;
        }
      }
    </style>
    <style is:global data-label="ROOT_LAYOUT">
      :root {
        --color-bg-page: #f9fafb;
        --color-text-primary: #111827;
        --color-gridline: #ef4444;
        --layout-max-width: 1100px;
        --layout-gutter: 1.25rem;
        --layout-guide-width: 1px;
        --layout-guide-style: dashed;
        --layout-vertical-padding: 3rem;
        --layout-footer-height: 3rem;
      }
      body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', Arial, sans-serif;
        display: flex;
        background-color: var(--color-bg-page);
        color: var(--color-text-primary);
        min-height: 100vh;
      }
      .RootLayout {
        position: relative;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        z-index: 0;
      }
      .RootLayout::before,
      .RootLayout::after {
        content: '';
        border-top: var(--layout-guide-width) var(--layout-guide-style) var(--color-gridline);
        height: 0;
        position: absolute;
        left: 0;
        right: 0;
        z-index: 1;
        opacity: 1;
      }
      .RootLayout::before {
        top: var(--layout-vertical-padding);
      }
      .RootLayout::after {
        bottom: var(--layout-vertical-padding);
        border-bottom: var(--layout-guide-width) var(--layout-guide-style) var(--color-gridline);
        border-top: none;
      }
      .RootLayoutContainer {
        width: calc(100% - (var(--layout-gutter) * 2));
        max-width: var(--layout-max-width);
        min-height: 100%;
        position: relative;
        margin-inline: auto;
        display: flex;
        flex-direction: column;
        border: none;
        padding-top: var(--layout-vertical-padding);
        padding-bottom: 0;
        box-sizing: border-box;
      }
      .RootLayoutContent {
        display: flex;
        flex-direction: column;
        padding: 2rem 0;
        gap: 3rem;
        flex: 1;
      }
      .RootLayoutFooter {
        width: 100%;
        height: var(--layout-footer-height);
        position: static;
        bottom: auto;
        left: 0;
        right: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85rem;
        color: #6b7280;
        border-top: none;
        margin-top: var(--layout-footer-height);
      }
      h2.demo-title {
        margin: 0 0 0.5rem 0;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-align: center;
        color: #374151;
      }
      p.demo-desc {
        text-align: center;
        margin: 0 0 1rem 0;
        font-size: 0.85rem;
        color: #9ca3af;
      }
      @media (min-width: 64rem) {
        .RootLayout::before,
        .RootLayout::after {
          opacity: 1;
          background-color: transparent;
          height: 0;
        }
        .RootLayoutContent {
          padding: 2rem;
        }
        .RootLayoutContainer {
          border-left: var(--layout-guide-width) var(--layout-guide-style) var(--color-gridline);
          border-right: var(--layout-guide-width) var(--layout-guide-style) var(--color-gridline);
        }
        .RootLayoutContainer:before,
        .RootLayoutContainer:after {
          content: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="RootLayout">
      <div class="RootLayoutContainer">
        <div class="RootLayoutContent">
          <div>
            <h2 class="demo-title">Area 1: Services & Branding</h2>
            <p class="demo-desc">Gap: 6rem | Speed: Slow | Separator: MD Pabel Logo</p>
            <div
              id="marquee-demo-1"
              style="background: #fff; border: 1px solid #eee; border-radius: 6px; padding: 1rem 0; --um-font-size: 1.5rem; --um-gap: 6rem; --um-separator-height: 24px"
            >
              <noscript>Javascript Required.</noscript>
            </div>
          </div>
          <div>
            <h2 class="demo-title">Area 2: News Ticker</h2>
            <p class="demo-desc">Gap: 2rem | Speed: Fast | Dark Theme</p>
            <div
              id="marquee-demo-2"
              style="background: #111827; color: white; padding: 0.8rem 0; --um-font-size: 1rem; --um-gap: 2rem;"
            >
            </div>
          </div>
          <div>
            <h2 class="demo-title">Area 3: Full Lazy Loading Gallery</h2>
            <p class="demo-desc">Items & Separators are Images with Skeleton Loaders</p>
            <div id="marquee-full-lazy" style="--um-gap: 3rem; --um-separator-height: 40px"></div>
          </div>
        </div>
        <div class="RootLayoutFooter">
          <span>Universal Marquee Demo &copy; 2025 – Consistent Grid</span>
        </div>
      </div>
    </div>
    <script type="module">
      class ContentBuilder {
        constructor(options) {
          this._opts = options;
        }

        #buildSeparatorNode(separator) {
          const container = document.createElement('span');
          container.classList.add('um-item-separator');
          container.setAttribute('aria-hidden', 'true');

          if (typeof separator === 'string') {
            container.textContent = separator;
          } else if (separator instanceof Node) {
            container.appendChild(separator.cloneNode(true));
          } else if (typeof separator === 'object' && separator?.type === 'image') {
            const wrapper = document.createElement('div');
            wrapper.className = 'um-img-skeleton';

            const img = document.createElement('img');
            img.src = separator.src;
            img.alt = separator.alt || '';
            img.loading = 'lazy';

            img.onload = () => img.classList.add('loaded');
            if (img.complete) img.classList.add('loaded');

            wrapper.appendChild(img);
            container.appendChild(wrapper);
          }

          // Prevent any descendant from being focusable
          container.querySelectorAll('*').forEach((el) => {
            if (el.id) el.removeAttribute('id');
            el.setAttribute('tabindex', '-1');
          });

          return container;
        }

        // addTrailingSeparator: true untuk seamless loop (mode animasi), false untuk daftar statis (reduced motion)
        buildCycleContent(forSR = false, addTrailingSeparator = true) {
          const frag = document.createDocumentFragment();
          const items = this._opts.items;
          if (!items?.length) return frag;

          for (let i = 0; i < items.length; i++) {
            const item = items[i];

            if (forSR) {
              const li = document.createElement('li');
              li.textContent = item.alt || item;
              frag.appendChild(li);
            } else {
              let node = this._opts.renderItem(item);
              if (!(node instanceof Element)) {
                const wrapper = document.createElement('span');
                wrapper.appendChild(node);
                node = wrapper;
              }

              const cloned = node.cloneNode(true);

              // Handle lazy loading untuk gambar dalam item
              const img = cloned.querySelector('img');
              if (img) {
                img.onload = () => img.classList.add('loaded');
                if (img.complete) img.classList.add('loaded');
              }

              // Remove IDs and prevent focus
              if (cloned.id) cloned.removeAttribute('id');
              cloned.querySelectorAll('*').forEach((el) => {
                if (el.id) el.removeAttribute('id');
                el.setAttribute('tabindex', '-1');
              });

              frag.appendChild(cloned);

              // Tambahkan separator kecuali pada item terakhir jika tidak diinginkan trailing
              if (i < items.length - 1 || addTrailingSeparator) {
                const sep = this.#buildSeparatorNode(this._opts.separator);
                if (sep) frag.appendChild(sep);
              }
            }
          }
          return frag;
        }

        buildCycleContainer(addTrailingSeparator = true) {
          const div = document.createElement('div');
          div.appendChild(this.buildCycleContent(false, addTrailingSeparator));
          return div;
        }

        buildSRList() {
          const ul = document.createElement('ul');
          ul.className = 'um-sr-only';
          ul.appendChild(this.buildCycleContent(true));
          return ul;
        }

        // Pengukuran selalu pakai trailing separator agar akurat untuk mode animasi
        measureCycleMetrics(root) {
          if (!this._opts.items?.length) return { width: 0, gap: 0 };

          const temp = document.createElement('div');
          temp.className = 'um-track';
          temp.style.position = 'absolute';
          temp.style.visibility = 'hidden';

          let gapVal = this._opts.gap;
          if (typeof gapVal === 'number') gapVal = `${gapVal}px`;
          temp.style.setProperty('--um-gap', gapVal);

          const cycle = this.buildCycleContainer(true);
          temp.appendChild(cycle);
          root.appendChild(temp);

          const width = cycle.offsetWidth || 0;
          const parsedGap = parseFloat(getComputedStyle(temp).gap || '0');

          root.removeChild(temp);
          return { width, gap: parsedGap };
        }
      }

      class AnimationController {
        constructor(track, opts) {
          this._track = track;
          this._opts = opts;
        }

        start(cycleWidth, gap) {
          if (this._anim) this._anim.cancel();

          if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

          const distance = cycleWidth + gap;
          if (distance <= 0) return;

          const speed = this._opts.speed > 0 ? this._opts.speed : 50;
          const duration = (distance / speed) * 1000;

          const from = 'translate3d(0,0,0)';
          const to = `translate3d(-${distance}px,0,0)`;
          const keyframes =
            this._opts.direction === 'right'
              ? [{ transform: to }, { transform: from }]
              : [{ transform: from }, { transform: to }];

          this._anim = this._track.animate(keyframes, {
            duration,
            iterations: Infinity,
            easing: 'linear',
          });
        }

        pause() {
          if (this._anim?.playState === 'running') this._anim.pause();
        }

        play() {
          if (this._anim?.playState !== 'running') this._anim.play();
        }

        cancel() {
          if (this._anim) this._anim.cancel();
        }
      }

      class UniversalMarquee {
        constructor(selector, opts) {
          this._root = document.querySelector(selector);
          if (!this._root) return;

          this._opts = {
            speed: 50,
            gap: '2rem',
            direction: 'left',
            items: [],
            separator: '',
            renderItem: (i) => document.createTextNode(i),
            ...opts,
          };

          this._root.classList.add('um-container', 'js-enabled');
          this._builder = new ContentBuilder(this._opts);
          this.#setup();
          this.#initObservers();
        }

        #setup() {
          this._root.innerHTML = '';
          this._track = document.createElement('div');
          this._track.className = 'um-track';
          this._track.setAttribute('aria-hidden', 'true');
          if ('inert' in this._track) this._track.inert = true;

          this._root.appendChild(this._builder.buildSRList());
          this._root.appendChild(this._track);
          this.#reflow();
        }

        #reflow() {
          const metrics = this._builder.measureCycleMetrics(this._root);
          if (metrics.width === 0) return;

          const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

          // Hentikan animasi jika ada
          if (this._anim) {
            this._anim.cancel();
            this._anim = null;
          }

          // Hitung jumlah siklus yang dibutuhkan
          const baseCycles = Math.ceil(this._root.offsetWidth / (metrics.width + metrics.gap)) + 2;
          const cyclesCount = reducedMotion ? 1 : Math.max(3, baseCycles);

          this._track.innerHTML = '';
          const frag = document.createDocumentFragment();

          for (let i = 0; i < cyclesCount; i++) {
            // Trailing separator hanya untuk mode animasi (seamless loop)
            frag.appendChild(this._builder.buildCycleContainer(!reducedMotion));
          }

          this._track.appendChild(frag);

          // Jalankan animasi hanya jika bukan reduced motion
          if (!reducedMotion) {
            this._anim = new AnimationController(this._track, this._opts);
            this._anim.start(metrics.width, metrics.gap);
          }
        }

        #initObservers() {
          const resizeHandler = () => {
            clearTimeout(this._resizeTimer);
            this._resizeTimer = setTimeout(() => requestAnimationFrame(() => this.#reflow()), 200);
          };
          new ResizeObserver(resizeHandler).observe(this._root);

          if ('IntersectionObserver' in window) {
            this._observer = new IntersectionObserver(
              (entries) => {
                entries.forEach((entry) => {
                  if (!this._anim) return;
                  this._isInViewport = entry.isIntersecting;
                  entry.isIntersecting && !document.hidden ? this._anim.play() : this._anim.pause();
                });
              },
              { rootMargin: '50px 0px' }
            );
            this._observer.observe(this._root);
          }

          document.addEventListener('visibilitychange', () => {
            if (!this._anim) return;
            document.hidden ? this._anim.pause() : this._isInViewport && this._anim.play();
          });

          // Rebuild saat preferensi reduced-motion berubah
          const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
          mediaQuery.addEventListener('change', () => requestAnimationFrame(() => this.#reflow()));
        }
      }

      window.UniversalMarquee = UniversalMarquee;
    </script>
    <script type="module">
      const initApp = () => {
        const ITEMS_DEMO_1 = ['Web Design', 'App Development', 'SEO Audit', 'Cloud Server', 'Consulting'];
        const SEPARATOR_DEMO_1 = { type: 'image', src: 'https://www.mdpabel.com/md-pabel.png', alt: 'Logo MDPabel' };

        const ITEMS_DEMO_2 = ['LOREM IPSUM', 'DOLOR SIT AMET', 'CONSECTETUR ADIPISCING', 'ELIT SED DO'];

        const GALLERY_ITEMS = [
          { src: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&q=80', alt: 'Red Shoe' },
          { src: 'https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?w=400&q=80', alt: 'White Sneaker' },
          { src: 'https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?w=400&q=80', alt: 'Green Shoe' },
        ];

        const textRenderer = (txt) => {
          const span = document.createElement('span');
          span.textContent = txt;
          span.style.fontWeight = '600';
          return span;
        };

        const imageRenderer = (item) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'um-img-skeleton';
          wrapper.style.width = '140px';
          wrapper.style.height = '90px';

          const img = document.createElement('img');
          img.src = item.src;
          img.alt = item.alt;
          img.loading = 'lazy';
          img.onload = () => img.classList.add('loaded');
          if (img.complete) img.classList.add('loaded');

          wrapper.appendChild(img);
          return wrapper;
        };

        new UniversalMarquee('#marquee-demo-1', {
          speed: 60,
          gap: '6rem',
          items: ITEMS_DEMO_1,
          separator: SEPARATOR_DEMO_1,
          renderItem: textRenderer,
        });

        new UniversalMarquee('#marquee-demo-2', {
          speed: 100,
          gap: '2rem',
          direction: 'right',
          items: ITEMS_DEMO_2,
          separator: ' • ',
          renderItem: (t) => {
            const span = document.createElement('span');
            span.textContent = t;
            span.style.color = '#e5e7eb';
            return span;
          },
        });

        new UniversalMarquee('#marquee-full-lazy', {
          speed: 50,
          gap: '3rem',
          items: GALLERY_ITEMS,
          separator: { type: 'image', src: 'https://cdn-icons-png.flaticon.com/512/766/766029.png', alt: '' },
          renderItem: imageRenderer,
        });
      };

      document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', initApp) : initApp();
    </script>
  </body>
</html>
