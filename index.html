<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Marquee v2.2 Demo</title>
    <style>
        /* --- 1. PAGE STYLING (Hanya untuk kosmetik demo) --- */
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #0f172a; /* Slate 900 */
            color: #f1f5f9;
            margin: 0;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 4rem;
            max-width: 800px;
            margin-inline: auto;
        }

        section {
            border-bottom: 1px solid #334155;
            padding-bottom: 2rem;
        }

        h2 { margin-bottom: 0.5rem; color: #38bdf8; }
        .badge { 
            background: #f59e0b; color: #000; padding: 2px 6px; 
            border-radius: 4px; font-size: 0.8rem; vertical-align: middle; 
        }
        p { margin-top: 0; color: #94a3b8; font-size: 0.95rem; margin-bottom: 1.5rem; }

        /* Container styling untuk demo */
        .marquee-container {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1rem 0;
            margin-bottom: 1rem;
        }

        /* --- 2. UNIVERSAL MARQUEE v2.2 CSS --- */
        
        .um-host {
            display: flex;
            width: 100%;
            overflow: hidden;
            position: relative;
            contain: layout paint;
            
            /* CSS Variables Defaults */
            --um-mask-width: 5%;
            --um-gap: 2rem;
            --um-bounce-dist: 0px; /* Variabel dinamis untuk mode Ping-Pong */
            
            /* Masking (Fade Edges) */
            mask-image: linear-gradient(to right, transparent 0%, black var(--um-mask-width), black calc(100% - var(--um-mask-width)), transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black var(--um-mask-width), black calc(100% - var(--um-mask-width)), transparent 100%);
            
            user-select: none;
            touch-action: pan-y;
        }

        .um-host.um-no-mask { mask-image: none; -webkit-mask-image: none; }

        .um-track {
            display: flex;
            width: max-content;
            flex-shrink: 0;
            gap: var(--um-gap);
            will-change: transform;
            transform: translate3d(0, 0, 0);
            
            animation-duration: var(--um-duration, 0s);
            animation-play-state: var(--um-play-state, running);
            animation-direction: var(--um-direction, normal);
            animation-delay: var(--um-delay, 0s);
            animation-iteration-count: infinite;
            
            /* Default: Infinite Loop */
            animation-name: um-scroll;
            animation-timing-function: linear;
        }

        /* Mode 1: Infinite Loop */
        @keyframes um-scroll {
            from { transform: translate3d(0, 0, 0); }
            to   { transform: translate3d(calc(-50% - (var(--um-gap) / 2)), 0, 0); }
        }

        /* Mode 2: Auto-Reverse (Ping-Pong) */
        .um-host.um-mode-reverse .um-track {
            animation-name: um-bounce;
            animation-direction: alternate; /* Bolak-balik */
            animation-timing-function: ease-in-out; /* Gerakan natural */
        }

        @keyframes um-bounce {
            0%   { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(calc(var(--um-bounce-dist) * -1), 0, 0); }
        }

        /* Interaction */
        .um-host.um-pause-hover:hover .um-track { animation-play-state: paused; }
        .um-host.um-pause-click:active .um-track { animation-play-state: paused; }

        .um-item { display: flex; align-items: center; flex-shrink: 0; }
        .um-separator { display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

        /* --- 3. CUSTOM ITEM STYLES --- */
        .news-item { font-weight: 600; white-space: nowrap; }
        .tag-live { background: #ef4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.7em; margin-right: 8px; text-transform: uppercase; }
        
        .song-item { font-family: 'Courier New', monospace; font-size: 1.2rem; color: #a5f3fc; }
        .song-icon { margin-right: 10px; }

    </style>
</head>
<body>

    <h1>UniversalMarquee v2.2 Demo</h1>

    <section>
        <h2>1. News Ticker (Standard Mode)</h2>
        <p>Fitur: Infinite Loop, Mobile First Responsive (Cepat di Desktop, Lambat di HP), Pause on Hover.</p>
        
        <div id="marquee-news" class="marquee-container"></div>
    </section>

    <section>
        <h2>2. Song Title <span class="badge">NEW v2.2</span></h2>
        <p>Fitur: <b>Auto Reverse</b>. Teks bergerak sampai ujung, diam sebentar (delay), lalu kembali. Cocok untuk teks panjang tunggal.</p>
        
        <div id="marquee-song" class="marquee-container" style="max-width: 300px; margin: 0 auto; border-color: #0ea5e9;"></div>
        
        <div style="text-align: center; margin-top: 1rem;">
            <button onclick="changeSong()" style="padding: 8px 16px; cursor: pointer;">Ganti Lagu (Hot Swap)</button>
        </div>
    </section>

    <script>
        /**
         * UNIVERSAL MARQUEE LIBRARY v2.2
         * (Auto-Reverse & Mobile First Included)
         */
        class UniversalMarquee {
            static #DEFAULTS = {
                speed: 50, gap: '2rem', direction: 'normal', delay: 0,
                autoReverse: false, // v2.2 Feature
                pauseOnHover: true, pauseOnClick: false,
                mask: true, maskWidth: '5%',
                responsive: {}, items: [], separator: null,
                renderItem: (item) => document.createTextNode(String(item)),
            };

            constructor(selector, options = {}) {
                this.root = document.querySelector(selector);
                if (!this.root) throw new Error(`Node '${selector}' not found.`);
                this.userOptions = options;
                this.config = { ...UniversalMarquee.#DEFAULTS, ...options };
                this._observers = [];
                this._resizeTimer = null;
                this._isManualPaused = false;
                this.#init();
            }

            updateItems(newItems) {
                this.config.items = newItems;
                this.#buildDOM();
                this.#waitForAssets().then(() => this.#syncPhysics());
            }

            pause() { this._isManualPaused = true; this.root.style.setProperty('--um-play-state', 'paused'); }
            play() { this._isManualPaused = false; this.root.style.setProperty('--um-play-state', 'running'); }
            set direction(val) { this.config.direction = val; this.root.style.setProperty('--um-direction', val); }
            set speed(pxPerSecond) { this.config.speed = pxPerSecond; this.#syncPhysics(); }

            destroy() {
                this._observers.forEach(obs => obs.disconnect());
                this.root.classList.remove('um-host', 'um-pause-hover', 'um-pause-click', 'um-no-mask', 'um-mode-reverse');
                this.root.innerHTML = '';
            }

            #init() {
                this.root.classList.add('um-host');
                this.#evaluateResponsive(); 
                this.#buildDOM();
                this.#waitForAssets().then(() => { this.#syncPhysics(); this.#attachObservers(); });
            }

            #buildDOM() {
                const singleSet = document.createDocumentFragment();
                this.config.items.forEach((item, index) => {
                    singleSet.appendChild(this.#createItemNode(item, index));
                    if (this.config.separator) singleSet.appendChild(this.#createSeparatorNode());
                });

                this.track = document.createElement('div');
                this.track.className = 'um-track';

                // --- v2.2 LOGIC: Auto Reverse vs Loop ---
                if (this.config.autoReverse) {
                    this.root.classList.add('um-mode-reverse');
                    this.track.appendChild(singleSet.cloneNode(true));
                } else {
                    this.root.classList.remove('um-mode-reverse');
                    const temp = document.createElement('div');
                    temp.style.cssText = 'position:absolute; visibility:hidden; width:max-content; display:flex; gap:var(--um-gap);';
                    temp.appendChild(singleSet.cloneNode(true));
                    this.root.appendChild(temp);
                    const contentW = temp.offsetWidth;
                    const viewportW = this.root.offsetWidth || window.innerWidth;
                    this.root.removeChild(temp);

                    if (contentW > 0) {
                        const coverage = Math.ceil(viewportW / contentW) + 1;
                        const filled = document.createDocumentFragment();
                        for (let i = 0; i < coverage; i++) filled.appendChild(singleSet.cloneNode(true));
                        const groupA = document.createElement('div');
                        groupA.style.display = 'flex'; groupA.style.gap = 'var(--um-gap)';
                        groupA.appendChild(filled.cloneNode(true));
                        const groupB = groupA.cloneNode(true);
                        this.#sanitizeIds(groupB);
                        this.track.appendChild(groupA);
                        this.track.appendChild(groupB);
                    }
                }
                this.root.innerHTML = '';
                this.root.appendChild(this.track);
            }

            #syncPhysics() {
                if (!this.track) return;
                let distance = 0;

                if (this.config.autoReverse) {
                    const contentW = this.track.scrollWidth;
                    const containerW = this.root.offsetWidth;
                    // Jarak = Seberapa banyak konten "tumpah" keluar container
                    distance = (contentW > containerW) ? contentW - containerW : 0;
                    this.root.style.setProperty('--um-bounce-dist', `${distance}px`);
                } else {
                    distance = this.track.scrollWidth / 2;
                }

                if (distance <= 0) {
                    this.root.style.setProperty('--um-duration', '0s');
                } else {
                    const duration = distance / this.config.speed;
                    this.root.style.setProperty('--um-duration', `${duration}s`);
                }
            }

            #evaluateResponsive() {
                const width = window.innerWidth;
                let targetConfig = { ...UniversalMarquee.#DEFAULTS, ...this.userOptions };
                if (this.userOptions.responsive) {
                    const bps = Object.keys(this.userOptions.responsive).map(Number).sort((a, b) => a - b);
                    for (const bp of bps) {
                        if (width >= bp) targetConfig = { ...targetConfig, ...this.userOptions.responsive[bp] };
                    }
                }
                
                const modeChanged = this.config.autoReverse !== targetConfig.autoReverse;
                this.config = targetConfig;
                this.#applyConfigStyles();
                if (modeChanged) this.#buildDOM();
                this.#syncPhysics();
            }

            #applyConfigStyles() {
                this.root.style.setProperty('--um-delay', `${this.config.delay}ms`);
                if (this.config.mask) {
                    this.root.classList.remove('um-no-mask');
                    this.root.style.setProperty('--um-mask-width', this.config.maskWidth);
                } else { this.root.classList.add('um-no-mask'); }
                this.root.classList.toggle('um-pause-hover', this.config.pauseOnHover);
                this.root.classList.toggle('um-pause-click', this.config.pauseOnClick);
                this.root.style.setProperty('--um-gap', this.#parseGap(this.config.gap));
                this.root.style.setProperty('--um-direction', this.config.direction);
            }

            #createItemNode(item, index) {
    // 1. Dapatkan hasil dari renderItem (bisa String atau Element)
    let content = this.config.renderItem(item, index);
    let node;

    // 2. Cek tipe datanya
    if (content instanceof Element) {
      // Jika user me-return document.createElement(...)
      node = content;
    } else {
      // Jika user me-return String HTML atau Teks biasa
      // Kita bungkus dengan div (atau span) dan gunakan innerHTML
      node = document.createElement('div');
      node.innerHTML = String(content);
      
      // Opsional: Jika wrapper menghasilkan extra spacing, atur display
      // node.style.display = 'contents'; // Hati-hati browser support
    }

    // 3. Tambahkan class wajib library
    node.classList.add('um-item');
    return node;
  }
            #createSeparatorNode() {
                const sep = document.createElement('span'); sep.className = 'um-separator';
                if (this.config.separator instanceof Node) sep.appendChild(this.config.separator.cloneNode(true));
                else sep.innerHTML = this.config.separator; return sep;
            }
            #sanitizeIds(node) { if (node.id) node.removeAttribute('id'); if (node.querySelectorAll) node.querySelectorAll('[id]').forEach(el => el.removeAttribute('id')); }
            #parseGap(gap) { return typeof gap === 'number' ? `${gap}px` : gap; }
            async #waitForAssets() {
                const images = Array.from(this.root.querySelectorAll('img'));
                if (images.length === 0) return Promise.resolve();
                const promises = images.map(img => {
                    if (img.complete && img.naturalHeight !== 0) return Promise.resolve();
                    return new Promise(resolve => { img.onload = () => resolve(); img.onerror = () => resolve(); });
                });
                await Promise.all(promises);
            }
            #attachObservers() {
                const io = new IntersectionObserver((entries) => {
                    if (this._isManualPaused) return;
                    this.root.style.setProperty('--um-play-state', entries[0].isIntersecting ? 'running' : 'paused');
                }, { threshold: 0.01 });
                io.observe(this.root);
                this._observers.push(io);
                const ro = new ResizeObserver((entries) => {
                    if (entries[0].contentRect.width === 0) return;
                    clearTimeout(this._resizeTimer);
                    this._resizeTimer = setTimeout(() => this.#evaluateResponsive(), 150);
                });
                ro.observe(this.root);
                this._observers.push(ro);
            }
        }

        // --- DEMO INITIALIZATION ---

        // Demo 1: News Ticker (Standard)
        const news = new UniversalMarquee('#marquee-news', {
            speed: 30, // Default Mobile Speed
            gap: '1rem',
            items: [
                "Breaking News: UniversalMarquee v2.2 Released",
                "Technology: AI Development Accelerates",
                "Market: Crypto hits new All Time High",
                "Weather: Sunny skies expected all week"
            ],
            renderItem: (text) => {
                const div = document.createElement('div');
                div.className = 'news-item';
                div.innerHTML = `<span class="tag-live">LIVE</span> ${text}`;
                return div;
            },
            separator: ' â€¢ ',
            responsive: {
                768: { speed: 60, gap: '3rem' } // Faster on Desktop
            }
        });

        // Demo 2: Song Player (Auto Reverse / Ping Pong)
        const songMarquee = new UniversalMarquee('#marquee-song', {
            autoReverse: true, // AKTIFKAN PING PONG
            
            items: ["Bohemian Rhapsody - Queen (2011 Remaster)"], // Teks panjang
            
            speed: 30, // Kecepatan gerak
            delay: 1500, // Diam 1.5 detik di ujung sebelum balik arah
            maskWidth: '20px',
            
            renderItem: (text) => {
                return `<span class="song-icon">ðŸŽµ</span><span class="song-item">${text}</span>`;
            }
        });

        // Helper untuk Demo 2
        function changeSong() {
            const songs = [
                "Hotel California - Eagles (Live at The Capital Centre)",
                "Stairway to Heaven - Led Zeppelin (Remastered)",
                "Sweet Child O' Mine - Guns N' Roses"
            ];
            // Pick random song
            const randomSong = songs[Math.floor(Math.random() * songs.length)];
            songMarquee.updateItems([randomSong]);
        }

    </script>
</body>
</html>