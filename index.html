<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Marquee v4.0 Demo</title>
    <style>
        /* --- RESET & DEMO PAGE STYLES --- */
        :root {
            --bg: #0f172a;
            --text: #f8fafc;
            --accent: #38bdf8;
            --card-bg: #1e293b;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding-bottom: 100px;
            overflow-x: hidden;
        }
        h1, h2, p { margin: 0; }
        
        header {
            text-align: center;
            padding: 4rem 1rem;
            background: linear-gradient(to bottom, #1e293b, #0f172a);
        }
        header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; color: var(--accent); }
        header p { color: #94a3b8; }

        section {
            margin: 3rem 0;
            border-top: 1px solid #334155;
            padding-top: 1rem;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        .section-title {
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            color: #cbd5e1;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .badge {
            font-size: 0.75rem;
            background: var(--accent);
            color: #000;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

        /* Demo Item Styles */
        .logo-box {
            width: 120px;
            height: 60px;
            background: var(--card-bg);
            border: 1px solid #334155;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: bold;
            color: #64748b;
        }

        .card-testimonial {
            width: 280px;
            padding: 1.5rem;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #334155;
            user-select: none; /* Penting untuk drag */
        }
        .card-testimonial h4 { color: var(--accent); margin-bottom: 0.5rem; }
        .card-testimonial p { font-size: 0.9rem; color: #94a3b8; line-height: 1.5; }

        .photo-item {
            width: 200px;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            filter: grayscale(0.5);
            transition: filter 0.3s;
        }
        .photo-item:hover { filter: grayscale(0); }

        .rtl-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e2e8f0;
            padding: 0 1rem;
            background: #334155;
            border-radius: 50px;
            height: 50px;
            display: flex;
            align-items: center;
        }

        /* --- UNIVERSAL MARQUEE v4.0 CSS --- */
        .um-host {
            display: flex;
            width: 100%;
            overflow: hidden;
            position: relative;
            direction: var(--um-direction-attr, ltr);
            contain: layout paint;
            
            --um-mask-width: 5%;
            --um-gap: 2rem;
            --um-duration: 0s;
            --um-direction: normal; 
            --um-delay: 0s;
            --um-play-state: running;
            --um-align: center;
            --um-scroll-boost: 0px;
            
            user-select: none;
            touch-action: pan-y;
            -webkit-user-drag: none;
        }

        .um-host.um-cursor-grab { cursor: grab; }
        .um-host.um-cursor-grabbing { cursor: grabbing; }

        .um-host[data-mask="both"] {
            mask-image: linear-gradient(to right, transparent 0%, black var(--um-mask-width), black calc(100% - var(--um-mask-width)), transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black var(--um-mask-width), black calc(100% - var(--um-mask-width)), transparent 100%);
        }
        .um-host.um-no-mask { mask-image: none; -webkit-mask-image: none; }

        .um-track {
            display: flex;
            width: max-content;
            flex-shrink: 0;
            gap: var(--um-gap);
            align-items: var(--um-align);
            will-change: transform;
            transform: translate3d(var(--um-scroll-boost), 0, 0);
        }

        .um-animating .um-track {
            animation-name: um-scroll;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            animation-duration: var(--um-duration);
            animation-direction: var(--um-direction);
            animation-play-state: var(--um-play-state);
            animation-delay: var(--um-delay);
        }

        .um-dragging .um-track { animation: none !important; }
        .um-host.um-paused .um-track { animation-play-state: paused; }

        @keyframes um-scroll {
            0%   { transform: translate3d(calc(0px + var(--um-scroll-boost)), 0, 0); }
            100% { transform: translate3d(calc(-50% - (var(--um-gap) / 2) + var(--um-scroll-boost)), 0, 0); }
        }

        .um-item { display: flex; flex-shrink: 0; pointer-events: auto; height: 100%; }
        .um-item img { pointer-events: none; -webkit-user-drag: none; }
        .um-separator { display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1>Universal Marquee v4.0</h1>
            <p>GPU Accelerated • Inertia Drag • Scroll Velocity • Smart Performance</p>
        </div>
    </header>

    <section>
        <div class="container">
            <h2 class="section-title">1. Infinite Loop <span class="badge">Performance Optimized</span></h2>
            <div id="marquee-logos"></div>
        </div>
    </section>

    <section>
        <div class="container">
            <h2 class="section-title">2. Draggable & Momentum <span class="badge">Try Swiping!</span></h2>
            <p style="margin-bottom: 1rem; color: #64748b; font-size: 0.9rem;">Grab and throw the cards. Notice the physics decay.</p>
        </div>
        <div id="marquee-cards" style="padding: 1rem 0; background: #0b1120;"></div>
    </section>

    <section>
        <div class="container">
            <h2 class="section-title">3. Scroll Velocity & Randomize <span class="badge">Scroll Page Fast!</span></h2>
            <p style="margin-bottom: 1rem; color: #64748b; font-size: 0.9rem;">The marquee accelerates when you scroll the window. Items are randomized on reload.</p>
            <div id="marquee-photos"></div>
        </div>
    </section>

    <section>
        <div class="container">
            <h2 class="section-title">4. RTL Support <span class="badge">Right-to-Left</span></h2>
            <div id="marquee-rtl" style="margin-top: 1rem;"></div>
        </div>
    </section>

    <div style="height: 100vh;"></div> <script type="module">
        /**
         * UniversalMarquee v4.0 Class Definition
         * (Disatukan di sini agar bisa langsung jalan tanpa import external)
         */
        class UniversalMarquee {
            static #DEFAULTS = {
                speed: 50, gap: '2rem', direction: 'normal', alignItems: 'center', rtl: false,
                minClones: 0, randomize: false, pauseOnInvisibility: true,
                hoverBehavior: 'pause', draggable: false, dragSpeed: 1.2, dragMomentum: true,
                scrollVelocity: false, mask: true, maskSide: 'both', maskWidth: '5%',
                reducedMotionMode: 'stop',
                items: [], separator: null, renderItem: (item) => document.createTextNode(String(item)),
                onInit: () => {}, onDragStart: () => {}, onDragEnd: () => {}, onItemClick: () => {},
            };

            constructor(selector, options = {}) {
                this.root = document.querySelector(selector);
                if (!this.root) throw new Error(`Node '${selector}' not found.`);
                this.userOptions = options;
                this.config = { ...UniversalMarquee.#DEFAULTS, ...options };
                this._observers = []; this._resizeTimer = null; this._isManualPaused = false;
                this._drag = { active: false, startX: 0, currentX: 0, lastTranslate: 0, hasMoved: false, velocity: 0, lastTime: 0 };
                this._scroll = { currentOffset: 0, targetOffset: 0, rafId: null };
                this.#init();
            }

            #init() {
                this.root.classList.add('um-host');
                if (this.config.randomize) this.#shuffleItems();
                this.#handleReducedMotion();
                this.#evaluateResponsive();
                this.#buildDOM();
                this.#waitForAssets().then(() => {
                    this.#syncPhysics();
                    this.#attachObservers();
                    this.#attachEvents();
                    if (this.config.scrollVelocity) this.#initScrollTrigger();
                    if (this.config.onInit) this.config.onInit(this);
                });
            }

            #shuffleItems() {
                for (let i = this.config.items.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.config.items[i], this.config.items[j]] = [this.config.items[j], this.config.items[i]];
                }
            }

            #handleReducedMotion() {
                if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                    if (this.config.reducedMotionMode === 'stop') { this.config.speed = 0; this.pause(); }
                    else if (this.config.reducedMotionMode === 'reduce-speed') { this.config.speed *= 0.15; }
                }
            }

            #buildDOM() {
                const singleSet = document.createDocumentFragment();
                this.config.items.forEach((item, index) => {
                    singleSet.appendChild(this.#createItemNode(item, index));
                    if (this.config.separator) singleSet.appendChild(this.#createSeparatorNode());
                });

                this.track = document.createElement('div');
                this.track.className = 'um-track';
                
                const temp = document.createElement('div');
                temp.style.cssText = 'position:absolute;visibility:hidden;width:max-content;display:flex;gap:var(--um-gap);';
                temp.appendChild(singleSet.cloneNode(true));
                this.root.appendChild(temp);
                this._contentWidth = temp.offsetWidth;
                this.root.removeChild(temp);

                let clones = 0;
                if (this._contentWidth > 0) clones = Math.ceil((this.root.offsetWidth || window.innerWidth) / this._contentWidth);
                clones = Math.max(clones, this.config.minClones);

                const superGroup = document.createDocumentFragment();
                for (let i = 0; i <= clones; i++) superGroup.appendChild(singleSet.cloneNode(true));

                this.track.appendChild(superGroup.cloneNode(true));
                const groupB = superGroup.cloneNode(true);
                this.#sanitizeIds(groupB);
                this.track.appendChild(groupB);
                
                this.root.innerHTML = '';
                this.root.appendChild(this.track);
                this.root.classList.add('um-animating');
            }

            #syncPhysics() {
                if (!this.track) return;
                const loopDist = this.track.scrollWidth / 2;
                if (loopDist > 0) this.root.style.setProperty('--um-duration', `${loopDist / this.config.speed}s`);
            }

            #applyConfigStyles() {
                this.root.style.setProperty('--um-align', this.config.alignItems);
                this.root.style.setProperty('--um-direction-attr', this.config.rtl ? 'rtl' : 'ltr');
                if (this.config.rtl) this.root.setAttribute('dir', 'rtl'); else this.root.removeAttribute('dir');
                
                if (this.config.mask && this.config.maskSide !== 'none') {
                    this.root.setAttribute('data-mask', this.config.maskSide);
                    this.root.style.setProperty('--um-mask-width', this.config.maskWidth);
                } else { this.root.classList.add('um-no-mask'); }

                this.config.draggable ? this.root.classList.add('um-cursor-grab') : this.root.classList.remove('um-cursor-grab');
                this.root.style.setProperty('--um-gap', typeof this.config.gap === 'number' ? `${this.config.gap}px` : this.config.gap);
                this.root.style.setProperty('--um-direction', this.config.direction);
            }

            #attachEvents() {
                if (this.config.hoverBehavior === 'pause') {
                    this.root.addEventListener('mouseenter', () => !this._drag.active && this.root.classList.add('um-paused'));
                    this.root.addEventListener('mouseleave', () => !this._drag.active && !this._isManualPaused && this.root.classList.remove('um-paused'));
                }
                if (this.config.draggable) this.#initDraggable();
            }

            #attachObservers() {
                const ro = new ResizeObserver(entries => {
                    if (entries[0].contentRect.width === 0) return;
                    clearTimeout(this._resizeTimer);
                    this._resizeTimer = setTimeout(() => { this.#evaluateResponsive(); this.#syncPhysics(); }, 150);
                });
                ro.observe(this.root);
                this._observers.push(ro);

                if (this.config.pauseOnInvisibility) {
                    const io = new IntersectionObserver(entries => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting && !this._isManualPaused) {
                                this.root.classList.remove('um-paused');
                            } else if (!entry.isIntersecting) {
                                this.root.classList.add('um-paused');
                            }
                        });
                    });
                    io.observe(this.root);
                    this._observers.push(io);
                }
            }

            #initScrollTrigger() {
                let lastY = window.scrollY;
                const onScroll = () => {
                    const currY = window.scrollY;
                    const delta = currY - lastY;
                    lastY = currY;
                    this._scroll.targetOffset -= delta * 1.5;
                    if (!this._scroll.rafId) this._scroll.rafId = requestAnimationFrame(this.#updateScrollPhysics.bind(this));
                };
                window.addEventListener('scroll', onScroll, { passive: true });
                this._scrollListener = onScroll;
            }

            #updateScrollPhysics() {
                this._scroll.currentOffset += (this._scroll.targetOffset - this._scroll.currentOffset) * 0.1;
                this.root.style.setProperty('--um-scroll-boost', `${this._scroll.currentOffset}px`);
                this._scroll.targetOffset *= 0.9;
                if (Math.abs(this._scroll.currentOffset) < 0.5 && Math.abs(this._scroll.targetOffset) < 0.5) {
                    this._scroll.currentOffset = 0; this._scroll.targetOffset = 0;
                    this.root.style.setProperty('--um-scroll-boost', `0px`);
                    this._scroll.rafId = null;
                } else {
                    this._scroll.rafId = requestAnimationFrame(this.#updateScrollPhysics.bind(this));
                }
            }

            #initDraggable() {
                const start = (e) => {
                    if (e.button === 2) return;
                    if (this._rafId) cancelAnimationFrame(this._rafId);
                    this._drag.active = true; this._drag.hasMoved = false; this._drag.velocity = 0;
                    this._drag.startX = (e.touches ? e.touches[0].clientX : e.clientX);
                    this._drag.lastTime = performance.now();
                    const style = window.getComputedStyle(this.track);
                    this._drag.lastTranslate = (new WebKitCSSMatrix(style.transform)).m41;
                    this._drag.currentX = this._drag.lastTranslate;
                    this.root.classList.remove('um-animating');
                    this.root.classList.add('um-dragging', 'um-cursor-grabbing');
                    this.root.classList.remove('um-cursor-grab');
                    this.track.style.transform = `translate3d(${this._drag.currentX}px, 0, 0)`;
                    if(this.config.onDragStart) this.config.onDragStart();
                };
                const move = (e) => {
                    if (!this._drag.active) return;
                    e.preventDefault();
                    const now = performance.now();
                    const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
                    const delta = (clientX - this._drag.startX) * this.config.dragSpeed;
                    if (now - this._drag.lastTime > 0) this._drag.velocity = (this._drag.velocity * 0.5) + ((delta / (now - this._drag.lastTime)) * 0.5);
                    const newPos = this._drag.lastTranslate + delta;
                    this.track.style.transform = `translate3d(${newPos}px, 0, 0)`;
                    this._drag.currentX = newPos; this._drag.lastTime = now;
                    if (Math.abs(delta) > 5) this._drag.hasMoved = true;
                };
                const end = () => {
                    if (!this._drag.active) return;
                    this._drag.active = false;
                    this.root.classList.remove('um-dragging', 'um-cursor-grabbing');
                    this.root.classList.add('um-cursor-grab');
                    if (this.config.dragMomentum && Math.abs(this._drag.velocity) > 0.1) this.#startMomentum();
                    else this.#snapToCSS();
                    if(this.config.onDragEnd) this.config.onDragEnd();
                };
                this.root.addEventListener('mousedown', start); this.root.addEventListener('touchstart', start, {passive:false});
                window.addEventListener('mousemove', move); window.addEventListener('touchmove', move, {passive:false});
                window.addEventListener('mouseup', end); window.addEventListener('touchend', end);
                this._dragListeners = { start, move, end };
            }

            #removeDragListeners() {
                if(!this._dragListeners) return;
                const { start, move, end } = this._dragListeners;
                this.root.removeEventListener('mousedown', start); this.root.removeEventListener('touchstart', start);
                window.removeEventListener('mousemove', move); window.removeEventListener('touchmove', move);
                window.removeEventListener('mouseup', end); window.removeEventListener('touchend', end);
            }

            #startMomentum() {
                const loop = () => {
                    this._drag.velocity *= 0.95;
                    this._drag.currentX += this._drag.velocity * 16;
                    this.track.style.transform = `translate3d(${this._drag.currentX}px, 0, 0)`;
                    if (Math.abs(this._drag.velocity) < 0.01) this.#snapToCSS();
                    else this._rafId = requestAnimationFrame(loop);
                };
                loop();
            }

            #snapToCSS() {
                const loopLen = this.track.scrollWidth / 2;
                let norm = this._drag.currentX % loopLen;
                if (norm > 0) norm -= loopLen;
                const dur = parseFloat(getComputedStyle(this.root).getPropertyValue('--um-duration')) || 0;
                this.root.style.setProperty('--um-delay', `${-1 * (Math.abs(norm) / loopLen) * dur}s`);
                this.track.style.transform = '';
                this.root.classList.add('um-animating');
                if (this.config.hoverBehavior === 'pause' && this.root.matches(':hover')) this.root.classList.add('um-paused');
            }

            #createItemNode(item, i) {
                const w = document.createElement('div'); w.className = 'um-item';
                const c = this.config.renderItem(item, i);
                if (typeof c === 'string') w.innerHTML = c; else w.appendChild(c);
                if (this.config.onItemClick) {
                    w.style.cursor = 'pointer';
                    w.addEventListener('click', (e) => {
                        if (this.config.draggable && this._drag.hasMoved) { e.preventDefault(); e.stopPropagation(); return; }
                        this.config.onItemClick(item, i, e);
                    });
                }
                return w;
            }
            #createSeparatorNode() {
                const s = document.createElement('span'); s.className = 'um-separator';
                this.config.separator instanceof Node ? s.appendChild(this.config.separator.cloneNode(true)) : s.innerHTML = this.config.separator;
                return s;
            }
            #sanitizeIds(n) { if (n.id) n.removeAttribute('id'); n.querySelectorAll('[id]').forEach(e => e.removeAttribute('id')); }
            async #waitForAssets() {
                await Promise.all(Array.from(this.root.querySelectorAll('img')).map(i => {
                    if(i.complete) return; return new Promise(r => { i.onload=i.onerror=r });
                }));
                if (document.fonts) try { await document.fonts.ready; } catch(e){}
            }
            #evaluateResponsive() {
                const w = window.innerWidth;
                let cfg = { ...UniversalMarquee.#DEFAULTS, ...this.userOptions };
                if (this.userOptions.responsive) {
                    Object.keys(this.userOptions.responsive).map(Number).sort((a,b)=>a-b).forEach(bp => {
                        if(w>=bp) cfg = { ...cfg, ...this.userOptions.responsive[bp] };
                    });
                }
                this.config = cfg; this.#applyConfigStyles();
            }
            
            pause() { this._isManualPaused=true; this.root.classList.add('um-paused'); }
            play() { this._isManualPaused=false; this.root.classList.remove('um-paused'); }
        }

        /* --- INITIALIZATION --- */

        // 1. Logo Marquee
        const brands = ['NextJS', 'React', 'Vue', 'Svelte', 'Angular', 'Node', 'Deno', 'Bun', 'Vite'];
        new UniversalMarquee('#marquee-logos', {
            items: brands,
            speed: 40,
            gap: '3rem',
            renderItem: (name) => `<div class="logo-box">${name}</div>`,
            maskSide: 'both'
        });

        // 2. Testimonial Cards (Draggable)
        const testimonials = [
            { name: 'Sarah', role: 'Dev', text: 'Momentum drag feels native!' },
            { name: 'James', role: 'CTO', text: 'Performance is outstanding.' },
            { name: 'Annie', role: 'Designer', text: 'Seamless looping is magic.' },
            { name: 'Pabel', role: 'Manager', text: 'Responsive config saves time.' },
            { name: 'Mila', role: 'User', text: 'Very smooth animations.' }
        ];
        new UniversalMarquee('#marquee-cards', {
            items: testimonials,
            speed: 30,
            draggable: true,
            dragMomentum: true, // Enable Inertia
            dragSpeed: 1.5,
            gap: '1.5rem',
            renderItem: (data) => `
                <div class="card-testimonial">
                    <h4>${data.name} <span style="font-size:0.7em; color:#64748b">(${data.role})</span></h4>
                    <p>"${data.text}"</p>
                </div>
            `
        });

        // 3. Image Gallery (Scroll Velocity & Randomize)
        // Using colored divs for offline safety, but mimicking images
        const colors = ['#f87171', '#fb923c', '#fbbf24', '#a3e635', '#34d399', '#22d3ee', '#818cf8', '#e879f9'];
        new UniversalMarquee('#marquee-photos', {
            items: colors,
            speed: 60,
            gap: '1rem',
            scrollVelocity: true, // Boost speed on scroll
            randomize: true,      // Shuffle on reload
            renderItem: (color) => `<div class="photo-item" style="background:${color}"></div>`
        });

        // 4. RTL & Alignment
        const arabicWords = ['مرحبا', 'أهلا', 'تصميم', 'إبداع', 'سرعة', 'أداء'];
        new UniversalMarquee('#marquee-rtl', {
            items: arabicWords,
            rtl: true,
            speed: 40,
            gap: '2rem',
            mask: false, // Turn off mask to see edges
            renderItem: (word) => `<div class="rtl-text">${word}</div>`
        });

    </script>
</body>
</html>